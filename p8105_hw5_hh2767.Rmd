---
title: "p8105_hw5_hh2767"
author: "Haoran Hu"
date: "2018-11-5"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

#Problem 1

##Read in file names and files

In the following chunk, I will:

* Start with a dataframe containing all file names, using list.file function

* Use purrr::map to read in the data and save it as a new variable in the dataframe

```{r message=FALSE}
exp_files = list.files(".\\data\\data_exp") %>% 
  strsplit(split = " ") %>% 
  tibble() %>% 
  rename(., file_name = .) %>% 
  mutate(data = map(.x = file_name, ~read_csv(str_c(".\\data\\data_exp\\", .x)))) 

head(exp_files)
```

So far, I have created a dataframe called "files". It includes two columns:"file_name" and "data". The "file_name" column shows all the file names, and the "data" colume contains the data in each file corresponding to those file names. 

##Tidy the results

Next, I will:

* Show arms and IDs of subjects in the dataframe.

* Tidy the weekly observation data.

* Recode the data into informative forms. For example, changing "con" into "control".

```{r}
exp_data = 
  exp_files %>% 
  separate(file_name, into = c("arm", "subject_id"), sep = "_") %>% 
  separate(subject_id, into = c("subject_id", "remove"), sep = "\\.") %>% 
  select(-remove) %>% 
  mutate(., arm = recode(.$arm, con = "control", exp = "experiment")) %>% 
  unnest() %>% 
  gather(key = week, value = value, week_1:week_8) %>% 
  mutate(week = str_replace(week, "week_", " "),  
         subject = str_c(arm, "_", subject_id)) %>% 
  select(subject, arm, week, value)

str(exp_data)
  
```

The finel dataset is a `r nrow(exp_data)`(rows) * `r ncol(exp_data)`(cols) dataset. It contains four variables: 

* subject, which shows the ids of subjects. 

* arm, which shows whether a subject is in experimental arm or control arm

* week, which shows the time of an observation 

* value, which shows observation value

This dataset is a tidy dataset.

##Making a plot

```{r}
exp_data %>% 
  ggplot(aes(x = week, y = value, group = subject, color = arm)) + 
  labs(title = "Experiment observations on each subject over time", y = "Observation value") + 
  geom_line() +
  geom_point() +
  theme_bw()  + theme(legend.position = "bottom")

```

From the spaghetti plot, we can see that the observation values of subjects in experimental arm is higher than that of subjects in control arm. In addition, the observation values of subjects in experimental arm kept increasing over time, while the observation values of subjects in control arm remain stable. In other words, the difference between observation value of subjects in experimental arm and that of subjects in control arm became greater over time.

#Problem 2

##Read and describe the dataset

```{r}
homicide = read.csv(".\\data\\homicide-data.csv")
```

The raw dataset is a `r nrow(homicide)`(rows) * `r ncol(homicide)`(cols) dataset. The dataset contains information about `r nrow(homicide)` homicides occured in the US. The location, time, and information of victims of each homicide are included in the dataset. The dataset also indicates whether the homicides are solved or not.

##Adding variables and tidying the dataset

```{r}
homicide_summary = homicide %>% 
  mutate(city_state = str_c(city, ",", state)) %>% 
  group_by(city_state) %>% 
  summarize(
    num_unsolved = sum(disposition %in% c("Open/No arrest", "Closed without arrest")),
         num_total = n()
    )
  
str(homicide_summary)
```


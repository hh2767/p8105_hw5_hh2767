---
title: "p8105_hw5_hh2767"
author: "Haoran Hu"
date: "2018-11-5"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

#Problem 1

##Read in file names and files

In the following chunk, I will:

* Start with a dataframe containing all file names, using list.file function

* Use purrr::map to read in the data and save it as a new variable in the dataframe

```{r}
exp_files = list.files(".\\data") %>% 
  strsplit(split = " ") %>% 
  tibble() %>% 
  rename(., file_name = .) %>% 
  mutate(data = map(.x = file_name, ~read_csv(str_c(".\\data\\", .x)))) 

head(exp_files)
```

So far, I have created a dataframe called "files". It includes two columns:"file_name" and "data". The "file_name" column shows all the file names, and the "data" colume contains the data in each file corresponding to those file names. 

##Tidy the results

Next, I will:

* Show arms and IDs of subjects in the dataframe.

* Tidy the weekly observation data

* Recode the data into informative forms. For example, changing "con" into "control".

```{r}
exp_data = 
  exp_files %>% 
  separate(file_name, into = c("arm", "subject_id"), sep = "_") %>% 
  separate(subject_id, into = c("subject_id", "remove"), sep = "\\.") %>% 
  select(-remove) %>% 
  mutate(., arm = recode(.$arm, con = "control", exp = "experiment")) %>% 
  unnest() %>% 
  gather(key = week, value = value, week_1:week_8) %>% 
  mutate(week = str_replace(week, "week_", " "),  
         subject = str_c(arm, "_", subject_id)) %>% 
  select(subject, arm, week, value)

head(exp_data)
  
exp_data %>% 
  ggplot(aes(x = week, y = value, group = subject, color = arm)) + 
  labs(title = "Experiment observations on each subject over time") + 
  geom_line() +
  geom_point() +
  theme_bw()  + theme(legend.position = "bottom")

ggplot(aes(x = year, y = n_location, color = location_abbr)) +
  labs(title = "number of locations observed", y = "number of locations") +
  geom_line() + geom_point() +
  theme_bw() + viridis::scale_color_viridis(
    name = "Location", 
    discrete = TRUE
  ) + 
  theme(legend.position = "bottom")
```

